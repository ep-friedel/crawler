const admin={serverActions:{},options:{},vars:{seriesType:'oneVar'},methods:{},handler:{},proto:{}};admin.serverActions.markRead=(a,b)=>{const c=new XMLHttpRequest,d='/api/markRead?short='+shortName+'&chapter='+b;c.open('PUT',d,!0),c.setRequestHeader('Cache-Control','no-Cache'),c.setRequestHeader('jwt',admin.vars.jwt),c.onreadystatechange=()=>{4!=c.readyState||200!=c.status},c.send()},admin.serverActions.setLogLevel=(a)=>{const b=new XMLHttpRequest;b.open('PUT','/api/setLogLevel?Level='+a,!0),b.setRequestHeader('Cache-Control','no-Cache'),b.setRequestHeader('jwt',admin.vars.jwt),b.onreadystatechange=()=>{4!=b.readyState||200!=b.status},b.send()},admin.serverActions.markAllRead=(a)=>{const b=new XMLHttpRequest;b.open('PUT','/api/markAllRead'+a,!0),b.setRequestHeader('Cache-Control','no-Cache'),b.setRequestHeader('jwt',admin.vars.jwt),b.onreadystatechange=()=>{4!=b.readyState||200!=b.status},b.send()},admin.serverActions.resetChapterDB=()=>{const a=new XMLHttpRequest;a.open('PUT','/api/resetChapterDB',!0),a.setRequestHeader('Cache-Control','no-Cache'),a.setRequestHeader('jwt',admin.vars.jwt),a.onreadystatechange=()=>{4!=a.readyState||200!=a.status},a.send()},admin.serverActions.restartServer=()=>{const a=new XMLHttpRequest;a.open('PUT','/api/restartServer',!0),a.setRequestHeader('Cache-Control','no-Cache'),a.setRequestHeader('jwt',admin.vars.jwt),a.send()},admin.serverActions.getSeriesSettings=()=>{const a=new XMLHttpRequest;return new Promise((b)=>{a.open('GET','/api/series',!0),a.setRequestHeader('Cache-Control','no-Cache'),a.setRequestHeader('jwt',admin.vars.jwt),a.onreadystatechange=()=>{4==a.readyState&&200==a.status&&b(JSON.parse(a.response))},a.send()})},admin.serverActions.getFullChapterList=()=>{const a=new XMLHttpRequest;return new Promise((b)=>{a.open('GET','/api/requestFullChapterList',!0),a.setRequestHeader('Cache-Control','no-Cache'),a.setRequestHeader('jwt',admin.vars.jwt),a.onreadystatechange=()=>{4==a.readyState&&200==a.status&&(admin.vars.fullChapterList=JSON.parse(a.response.replace(/{"Chapter":(.*?)}/g,'$1')),admin.vars.fullChapterList.forEach((a)=>{a.chapters.sort((c,a)=>{if(-1===c.toString().indexOf('.'))return parseInt(c)-parseInt(a);return-1===c.toString().indexOf('.')?void 0:c.split('.')[0]===a.split('.')[0]?parseInt(c.split('.')[1])-parseInt(a.split('.')[1]):parseInt(c.split('.')[0])-parseInt(a.split('.')[0])})}),b())},a.send()})},admin.serverActions.deleteSeries=(a)=>{const b=new XMLHttpRequest;return new Promise((c,d)=>{b.open('DELETE','/api/series',!0),b.setRequestHeader('Cache-Control','no-Cache'),b.setRequestHeader('jwt',admin.vars.jwt),b.setRequestHeader('Content-type','application/x-www-form-urlencoded'),b.onreadystatechange=()=>{4===b.readyState&&200===b.status?c():4===b.readyState&&200!==b.status&&d()},b.send(a)})},admin.serverActions.series=(a,b)=>{const c=new XMLHttpRequest;return new Promise((d,e)=>{c.open(b?'PUT':'POST','/api/series',!0),c.setRequestHeader('Cache-Control','no-Cache'),c.setRequestHeader('jwt',admin.vars.jwt),c.setRequestHeader('Content-type','application/x-www-form-urlencoded'),c.onreadystatechange=()=>{4===c.readyState&&200===c.status?d():4===c.readyState&&200!==c.status&&e()},c.send(a)})},admin.serverActions.manualRefresh=()=>{const a=new XMLHttpRequest;a.open('PUT','/api/manualRefresh',!0),a.setRequestHeader('Cache-Control','no-Cache'),a.setRequestHeader('jwt',admin.vars.jwt),a.send()},admin.handler.showProperty=(a)=>{const b=a.currentTarget.nextElementSibling;-1===b.className.indexOf('hideSoft')?b.className+=' hideSoft':b.className=b.className.replace(/ hideSoft/g,'')},admin.handler.resetChapterDB=(a)=>{const b=a.currentTarget;-1===b.className.indexOf('confirm')?(b.className+=' confirm',admin.vars.resetChapterDBTimer=setInterval(()=>{b.className=b.className.replace(' confirm',''),clearInterval(admin.vars.resetChapterDBTimer)},5e3)):(admin.serverActions.resetChapterDB(),clearInterval(admin.vars.resetChapterDBTimer),b.className=b.className.replace(' confirm',''))},admin.handler.restartServer=(a)=>{const b=a.currentTarget;-1===b.className.indexOf('confirm')?(b.className+=' confirm',admin.vars.markAllReadTimer=setInterval(()=>{b.className=b.className.replace(' confirm',''),clearInterval(admin.vars.markAllReadTimer)},5e3)):(admin.serverActions.restartServer(),clearInterval(admin.vars.markAllReadTimer),b.className=b.className.replace(' confirm',''))},admin.handler.markAllRead=(a)=>{const b=a.currentTarget,c='chapter'===admin.vars.markRead?'?short='+admin.vars.markReadStorySelector.getValue():'';-1===b.className.indexOf('confirm')?(b.className+=' confirm',admin.vars.markAllReadTimer=setInterval(()=>{b.className=b.className.replace(' confirm',''),clearInterval(admin.vars.markAllReadTimer)},5e3)):(admin.serverActions.markAllRead(c),clearInterval(admin.vars.markAllReadTimer),b.className=b.className.replace(' confirm',''))},admin.handler.markAllReadToggle=(a)=>{const b=a.currentTarget;-1===b.className.indexOf(' on')?(b.className+=' on',admin.vars.markRead='all',admin.vars.markReadStorySelector.target.className+=' hideSoft'):(b.className=b.className.replace(' on',''),admin.vars.markRead='chapter',admin.vars.markReadStorySelector.target.className=admin.vars.markReadStorySelector.target.className.replace(/ hideSoft/g,''))},admin.handler.toggleAddSeries=(a)=>{const b=Array.from(document.querySelector('.inputSettings').children),c=Array.from(document.querySelector('.inputContainer').children),d=a.currentTarget.id;b.forEach((a)=>{-1!==a.className.indexOf('active')&&(a.className=a.className.replace(' active',''))}),a.currentTarget.className+=' active',admin.vars.seriesType=a.currentTarget.id,c.forEach((a)=>{-1===a.className.indexOf('hideSoft')&&(a.className+=' hideSoft')}),'oneVar'===d?([6,1,2,3,4,5,11].forEach((a)=>{c[a].className=c[a].className.replace(/ hideSoft/g,'')}),[10,7,8,9].forEach((a)=>{c[a].children[1].value=c[a].children[1].defaultValue})):'twoVar'===d?([8,1,2,3,4,5,6,7,10,11].forEach((a)=>{c[a].className=c[a].className.replace(/ hideSoft/g,'')}),c[9].children[1].value=c[9].children[1].defaultValue):'link'===d&&([3,1,2,9,11].forEach((a)=>{c[a].className=c[a].className.replace(/ hideSoft/g,'')}),[8,4,5,6,7,10].forEach((a)=>{c[a].children[1].value=c[a].children[1].defaultValue})),-1!==document.querySelector('#editSeries').className.indexOf('active')&&(c[0].className=c[0].className.replace(/ hideSoft/g,''),c[1].className+=' hideSoft')},admin.handler.toggleAddEditSeries=(a)=>{const b=Array.from(document.querySelector('.addOrEdit').children),c=Array.from(document.querySelector('.inputContainer').children),d=document.querySelector('.inputSettings'),e=document.querySelector('#editSeriesButton'),f=document.querySelector('#addSeriesButton'),g=document.querySelector('#deleteSeriesButton'),h=a.currentTarget.id;b.forEach((a)=>{-1!==a.className.indexOf('active')&&(a.className=a.className.replace(' active',''))}),a.currentTarget.className+=' active',admin.vars.seriesType=a.currentTarget.id,c.forEach((a)=>{-1===a.className.indexOf('hideSoft')&&(a.className+=' hideSoft',a.value='')}),'editSeries'===h?(c[0].className=c[0].className.replace(/ hideSoft/g,''),d.className=d.className.replace(/ hideSoft/g,''),f.className+=' hideSoft',g.className+=' hideSoft',e.className=e.className.replace(/ hideSoft/g,''),admin.serverActions.getSeriesSettings().then((a)=>{var b=admin.vars.editStoryTagPicker.getValue();admin.methods.applySettings(a.filter((a)=>{return a.short===b}))})):'addNewSeriesButton'===h?(d.className=d.className.replace(/ hideSoft/g,''),e.className+=' hideSoft',g.className+=' hideSoft',f.className=f.className.replace(/ hideSoft/g,''),document.querySelector('.inputSettings > .active').click()):'deleteSeries'===h&&(d.className+=' hideSoft',e.className+=' hideSoft',f.className+=' hideSoft',g.className=g.className.replace(/ hideSoft/g,''),c[0].className=c[0].className.replace(/ hideSoft/g,''))},admin.handler.readerLink=()=>{location.href='/'},admin.handler.deleteSeries=(a)=>{const b=admin.vars.editStoryTagPicker.getValue(),c=a.currentTarget;if(-1!==c.className.indexOf('confirm'))clearInterval(admin.vars.deleteSeriesTimer),c.className=c.className.replace(' confirm','');else return c.className+=' confirm',void(admin.vars.deleteSeriesTimer=setInterval(()=>{c.className=c.className.replace(' confirm',''),clearInterval(admin.vars.deleteSeriesTimer)},5e3));dataString='short='+b,admin.serverActions.deleteSeries(dataString).then(()=>{admin.methods.clearAddSeriesInput(),admin.methods.renewSliders()}).catch(()=>{})},admin.handler.addSeries=(a,b)=>{const c=document.querySelector('#nameField').value,d=document.querySelector('#shortField').value,e=document.querySelector('#rssField').value,f=document.querySelector('#url1Field').value,g=document.querySelector('#url2Field').value,h=document.querySelector('#url3Field').value,i=document.querySelector('#var1Field').value,j=document.querySelector('#var2Field').value,k=document.querySelector('#currentLinkField').value,l=document.querySelector('#bookChapterResetField').value,m=document.querySelector('#minChapLen').value,n=b.currentTarget;if(-1!==n.className.indexOf('confirm'))clearInterval(admin.vars.seriesTimer),n.className=n.className.replace(' confirm','');else return n.className+=' confirm',void(admin.vars.seriesTimer=setInterval(()=>{n.className=n.className.replace(' confirm',''),clearInterval(admin.vars.seriesTimer)},5e3));dataString='name='+c+'&short='+d+'&url1='+f+'&url2='+g+'&url3='+h+'&currentLink='+k+'&bookChapterReset='+l+'&rss='+e+'&minChapterLength='+m,dataString+='oneVar'===admin.vars.seriesType||'link'===admin.vars.seriesType?'&book=false&chapter='+i:'&book='+i+'&chapter='+j,admin.serverActions.series(dataString,!!a).then(()=>{admin.methods.clearAddSeriesInput(),admin.methods.renewSliders()}).catch(()=>{})},admin.handler.setLogLevel=()=>{admin.serverActions.setLogLevel(admin.vars.logLevelPicker.getValue())},admin.methods.applySettings=(a)=>{const b=document.querySelectorAll('.inputSettings p'),c=document.querySelectorAll('.inputContainer input');-1!==document.querySelector('#editSeries').className.indexOf('active')&&(b[2>a[0].url1.length?2:'false'===a[0].start2?0:1].click(),c[0].value=a[0].short,c[1].value=a[0].name,c[2].value=a[0].rss,c[3].value=a[0].url1,c[4].value=a[0].start,c[5].value=a[0].url2,c[6].value=a[0].start2,c[7].value=a[0].url3,c[8].value=a[0].currentLink,c[9].value=a[0].bookChapterReset,c[10].value=a[0].minChapterLength)},admin.methods.clearAddSeriesInput=()=>{const a=Array.from(document.querySelector('.inputContainer').children);a.forEach((a)=>{void 0===a.children[1]||(a.children[1].value=a.children[1].defaultValue)})},admin.methods.renewSliders=()=>{admin.serverActions.getFullChapterList().then(()=>{admin.vars.removeChapterStorySelector.newData(admin.vars.fullChapterList,'short'),admin.vars.markReadStorySelector.newData(admin.vars.fullChapterList,'short'),admin.vars.editStoryTagPicker.newData(admin.vars.fullChapterList,'short')})},admin.proto.picker=function(a,b){var c=Math.round;const d=this;d.options={},d.init=()=>{d._setOptions()&&(d._render(),d._registerListeners(),d.initialized=!0,d.currentId=d.list.children[0].innerText,d.cb!==void 0&&d.cb(d.currentPosition,d.currentId))},d._setOptions=()=>{return(void 0!==a.target||void 0!==a.data)&&(d.target=a.target,d.cb=b,d.currentPosition=0,d.options.factor=a.factor||1,d.options.frameClass=a.frameClass||'frame',d.options.tagClass=a.tagClass||'tag',d.options.listClass=a.listClass||'list',d.options.tag=a.tag||'',d.options.dataprop=a.dataprop||!1,d.options.data=a.data,!0)},d._render=()=>{d.frame=document.createElement('div'),d.tag=document.createElement('span'),d.list=document.createElement('ul'),d.frame.className=d.options.frameClass,d.tag.className=d.options.tagClass,d.list.className=d.options.listClass,d.target.appendChild(d.frame),d.frame.appendChild(d.tag),d.frame.appendChild(d.list),d.tag.innerText=d.options.tag,d._renderList()},d._renderList=()=>{d.options.data.forEach((a)=>{const b=document.createElement('li');b.innerText=d.options.dataprop?a[d.options.dataprop]:a,d.list.appendChild(b)}),d.list.children[0].style.marginTop='0px'},d._emptyList=()=>{d.list.innerHTML=''},d._registerListeners=()=>{d.list.addEventListener('touchstart',d._touchstart,!1),d.list.addEventListener('touchmove',d._touchmove,!1),d.list.addEventListener('touchend',d._touchend,!1),d.list.addEventListener('mousedown',d._mousedown,!1)},d._mousedown=(a)=>{a.stopPropagation(),a.preventDefault(),d.startTrans=d.getMarginTop(),d.startX=parseInt(a.clientX),d.startY=parseInt(a.clientY),document.querySelector('body').addEventListener('mousemove',d._mousemove,!1),document.querySelector('body').addEventListener('mouseup',d._mouseup,!1),document.querySelector('body').addEventListener('mouseout',d._mouseout,!1)},d._mouseup=(a)=>{a.stopPropagation(),a.preventDefault();const b=-c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height);b!==d.currentPosition&&d.cb!==void 0&&(d.currentPosition=b,d.currentId=d.list.children[-c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height)].innerText,d.cb(b,d.currentId)),document.querySelector('body').removeEventListener('mousemove',d._mousemove),document.querySelector('body').removeEventListener('mouseup',d._mouseup),document.querySelector('body').removeEventListener('mouseout',d._mouseout)},d._mouseout=(a)=>{a.relatedTarget&&'HTML'!==a.relatedTarget.nodeName||d._mouseup(a)},d._mousemove=(a)=>{a.stopPropagation(),a.preventDefault(),d.currentY=parseInt(a.clientY),d._moveFunction(a.clientY)},d._moveFunction=(a)=>{var b=d.startY-d.currentY,e=d.list.children[0].getBoundingClientRect().height,f=-d.list.scrollHeight+d.getMarginTop()+2*e,g=4*b/window.innerHeight,h=-(g*g*g*d.options.factor)*-f+d.startTrans,i=c(h/e)*e,j=c(f/e)*e;0>h&&i>=j?d.list.children[0].style.marginTop=i+'px':(d.list.children[0].style.marginTop=0<=h?'0':j+'px',d.startY=parseInt(a),d.startTrans=d.getMarginTop())},d._touchstart=(a)=>{a.stopPropagation(),a.preventDefault(),d.startTrans=d.getMarginTop(),d.startX=parseInt(a.touches[0].clientX),d.startY=parseInt(a.touches[0].clientY)},d._touchmove=(a)=>{a.stopPropagation(),a.preventDefault(),d.currentY=parseInt(a.touches[0].clientY),d._moveFunction(a.touches[0].clientY)},d._touchend=(a)=>{a.stopPropagation(),a.preventDefault();const b=-c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height);b!==d.currentPosition&&d.cb!==void 0&&(d.currentPosition=b,d.currentId=d.list.children[-c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height)].innerText,d.cb(b,d.currentId))},d.newData=(b,c)=>{d.initialized?(d.options.dataprop=c||!1,d.options.data=b,d._emptyList(),d._renderList()):0<b.length&&(a.dataprop=c||!1,a.data=b,d.init())},d.goto=(a)=>{return void 0===a||isNaN(parseInt(a))||0>=a&&a>=d.options.data.length?!1:(d.list.children[0].style.marginTop=-parseInt(a)*d.list.children[0].getBoundingClientRect().height+'px',!0)},d.getMarginTop=()=>{var a=parseInt(d.list.children[0].style.marginTop);return isNaN(a)?0:a},d.getValue=()=>{return d.list.children[-c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height)].innerText},d.getPosition=()=>{return c(d.getMarginTop()/d.list.children[0].getBoundingClientRect().height)},d._setOptions(),(0<d.options.data.length||d.options.target!==void 0)&&d.init()},document.addEventListener('DOMContentLoaded',()=>{admin.vars.jwt=localStorage.jwt,admin.serverActions.getFullChapterList().then(()=>{admin.vars.removeChapterStorySelector=new admin.proto.picker({target:document.querySelector('#removeChapterPicker'),frameClass:'storypicker',tagClass:'storyTag',listClass:'story list',tag:'Story:',data:admin.vars.fullChapterList,dataprop:'short'},(a)=>{void 0===admin.vars.removeChapterChapterSelector||(admin.vars.removeChapterChapterSelector.newData(admin.vars.fullChapterList[a].chapters),admin.vars.removeChapterChapterSelector.goto(admin.vars.fullChapterList[a].chapters.length-1))}),admin.vars.removeChapterChapterSelector=new admin.proto.picker({target:document.querySelector('#removeChapterPicker'),frameClass:'chapterpicker',tagClass:'chapterTag',listClass:'chapter list',tag:'Chapter:',data:admin.vars.fullChapterList[0].chapters,factor:5}),admin.vars.removeChapterChapterSelector.goto(admin.vars.fullChapterList[0].chapters.length-1),admin.vars.markReadStorySelector=new admin.proto.picker({target:document.querySelector('#markReadStoryPicker'),frameClass:'storypicker',tagClass:'storyTag',listClass:'story list',tag:'Select Story:',data:admin.vars.fullChapterList,dataprop:'short'}),admin.vars.editStoryTagPicker=new admin.proto.picker({target:document.querySelector('#editStoryTagPicker'),frameClass:'storypicker fullWidth',tagClass:'storyTag',listClass:'story list',tag:'Select Story:',data:admin.vars.fullChapterList,dataprop:'short'},(a,b)=>{admin.serverActions.getSeriesSettings().then((a)=>{admin.methods.applySettings(a.filter((a)=>{return a.short===b}))})})}),admin.vars.logLevelPicker=new admin.proto.picker({target:document.querySelector('#logLevelPicker'),frameClass:'storypicker fullWidth',tagClass:'storyTag',listClass:'story list',tag:'Select Log-Level:',data:[1,2,3,4,5,9,11]}),document.querySelector('#logLevelButton').addEventListener('click',admin.handler.setLogLevel,!1),document.querySelector('#serverActionsHead').addEventListener('click',admin.handler.showProperty,!1),document.querySelector('#manageSeriesHead').addEventListener('click',admin.handler.showProperty,!1),document.querySelector('#serverSettingsHead').addEventListener('click',admin.handler.showProperty,!1),document.querySelector('#rebuildDB').addEventListener('click',admin.handler.resetChapterDB,!1),document.querySelector('#markAllReadButton').addEventListener('click',admin.handler.markAllRead,!1),document.querySelector('#markAllRead .toggleButton').addEventListener('click',admin.handler.markAllReadToggle,!1),document.querySelector('#oneVar').addEventListener('click',admin.handler.toggleAddSeries,!1),document.querySelector('#twoVar').addEventListener('click',admin.handler.toggleAddSeries,!1),document.querySelector('#link').addEventListener('click',admin.handler.toggleAddSeries,!1),document.querySelector('#addNewSeriesButton').addEventListener('click',admin.handler.toggleAddEditSeries,!1),document.querySelector('#editSeries').addEventListener('click',admin.handler.toggleAddEditSeries,!1),document.querySelector('#deleteSeries').addEventListener('click',admin.handler.toggleAddEditSeries,!1),document.querySelector('#addSeriesButton').addEventListener('click',admin.handler.addSeries.bind(null,!1),!1),document.querySelector('#editSeriesButton').addEventListener('click',admin.handler.addSeries.bind(null,!0),!1),document.querySelector('#deleteSeriesButton').addEventListener('click',admin.handler.deleteSeries,!1),document.querySelector('#restartServer').addEventListener('click',admin.handler.restartServer,!1),document.querySelector('#readerLink').addEventListener('click',admin.handler.readerLink,!1),document.querySelector('#triggerCrawler').addEventListener('click',admin.serverActions.manualRefresh,!1)});