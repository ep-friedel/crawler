var front={};document.addEventListener('DOMContentLoaded',()=>{front={serverActions:{},methods:{},handler:{reader:{},content:{},menu:{}},options:{server:'https://crawler.fochlac.com'},chapters:[],proto:{},el:{body:document.querySelector('body'),reader:document.getElementById('reader'),readerList:document.getElementById('reader').children[0],message:document.getElementById('message'),menu:document.getElementById('menu'),sound:document.getElementById('sound'),toggleSound:document.getElementById('toggleSound'),toggleVibrate:document.getElementById('toggleVibrate'),markReadButton:document.getElementById('markReadButton'),adminButton:document.getElementById('adminButton'),refreshButton:document.querySelector('.refresh'),statusRow:document.querySelector('#status')},vars:{confirmTimers:[],createdStoryElem:{},currentStory:'',deleteStash:[],freshList:!1,fullChapterList:[],keydownAllowed:!0,loadingState:{},notificationSettings:{},reference:{},startTrans:0,startX:0,startY:0,subscriptionList:[],user:{}}},front.handler.reader.toggleChapter=(e)=>{const t=front.vars.createdStoryElem[e];let r,s,a=front.methods.getCurrentVisibleChapter();if(0===front.vars.loadingState[e].state)return front.vars.loadingState.message&&front.vars.loadingState.message.f?front.vars.loadingState.message.f.resetTimer():front.vars.loadingState.message=new front.proto.message({closeTimer:2e3,messageText:'Still loading first chapter, please wait.'}),void front.methods.changeLoadingPriority(e);if(t.content.classList.contains('hidden')){if(front.methods.checkAllChaptersRead(e))return;if(Array.from(front.el.readerList.children).forEach((t)=>{t.id!==e&&t.classList.add('hidden')}),!Array.from(t.content.childNodes).filter((e)=>e&&!e.classList.contains('hiddenChapter')&&!e.classList.contains('hidden')).length){for(s=t.content.childNodes[0];null!==s&&s.classList.contains('hidden');)s=s.nextElementSibling;null!==s&&s.classList.remove('hiddenChapter')}t.content.classList.remove('hidden'),front.vars.currentStory=e,front.el.body.classList.add('readerMode'),front.el.body.classList.remove('menuMode'),front.el.refreshButton.classList.add('hidden'),front.el.markReadButton.classList.remove('hidden')}else front.methods.menuMode(e),r=a&&a.id?front.vars.reference[a.id]:void 0,front.methods.hideItem(r)},front.handler.content.keys=(e)=>{const t=front.handler.content.slide;var r='l';if('keyup'===e.type)switch(e.keyCode){case 39:r='r';case 37:front.el.body.classList.contains('readerMode')&&(front.vars.startTrans=parseInt(front.vars.createdStoryElem[front.vars.currentStory].content.style.transform.split('(')[1]),isNaN(front.vars.startTrans)&&(front.vars.startTrans=0),t(r));}},front.handler.content.markReadButton=()=>{const e=front.methods.getCurrentVisibleChapter();let t,r;if(null===e)front.methods.menuMode(front.vars.currentStory);else if(t=front.vars.reference[e.id],t.read||front.methods.markRead(t),front.methods.hideItem(t),front.methods.checkAllChaptersRead(t.short))front.vars.refresh&&front.methods.refreshedChapterList(),front.methods.menuMode(front.vars.currentStory);else{for(r=e.nextElementSibling;null!==r&&r.classList.contains('hidden');)r=r.nextElementSibling;if(null===r)for(r=e.previousElementSibling;null!=r&&r.classList.contains('hidden');)r=r.previousElementSibling;null===r?front.methods.menuMode(front.vars.currentStory):r.classList.remove('hiddenChapter')}},front.handler.content.scroll=(e)=>{var t=front.vars.reference[e.currentTarget.id];e.currentTarget.scrollTop+e.currentTarget.offsetHeight+100>e.currentTarget.scrollHeight&&!t.read&&front.methods.markRead(t)},front.handler.content.slide=(e)=>{const t=front.vars.createdStoryElem[front.vars.currentStory].content,r=front.methods.getCurrentVisibleChapter();let s,a;if(null!==r){for(s=front.vars.reference[r.id],a='l'===e?r.previousElementSibling:r.nextElementSibling;null!==a&&a.classList.contains('hidden');)a='l'===e?a.previousElementSibling:a.nextElementSibling;null!==a&&(front.methods.hideItem(s),r.classList.add('hiddenChapter'),a.classList.remove('hiddenChapter'))}else;},front.handler.content.touchstart=(e)=>{const t=front.vars.createdStoryElem[front.vars.currentStory].content;front.vars.startTrans=parseInt(t.style.transform.split('(')[1]),isNaN(front.vars.startTrans)&&(front.vars.startTrans=0),front.vars.startX=parseInt(e.touches[0].clientX),front.vars.startY=parseInt(e.touches[0].clientY)},front.handler.content.touchend=(e)=>{const t=front.vars.startY-parseInt(e.changedTouches[0].clientY),r=front.vars.startX-parseInt(e.changedTouches[0].clientX);r>0.25*front.el.body.offsetWidth?front.handler.content.slide('r'):r<-0.25*front.el.body.offsetWidth&&front.handler.content.slide('l')},front.handler.menu.fullReload=()=>{location.reload()},front.handler.menu.gotoAdmin=()=>{window.location.href='/admin'},front.handler.menu.loadStory=(e)=>{if(!front.vars.fullChapterList.length){let t=new front.proto.busyLayer({target:e.currentTarget.parentElement,message:'Loading'});t.init(),front.setupLoadChapterSliders(front.serverActions.getFullChapterList(),t)}front.handler.menu.toggleMinimized(e)},front.handler.menu.loadChapters=()=>{const e=front.vars.loadStorySelector.getValue(),t=front.vars.loadChapterSelector1.getValue(),r=front.vars.loadChapterSelector2.getValue();front.methods.loadChapterList(e,t,r),front.handler.menu.show()},front.handler.menu.logout=(e)=>{front.methods.confirm(e.currentTarget,front.methods.logout,'logout')},front.handler.menu.markAllRead=(e)=>{const t='chapter'===front.vars.markRead?'?short='+front.vars.markReadStorySelector.getValue():'';front.methods.confirm(e.currentTarget,front.serverActions.markAllRead,'markAllRead',t)},front.handler.menu.markAllReadToggle=(e)=>{const t=e.currentTarget;t.classList.contains('fa-check')?(t.classList.remove('fa-check'),t.classList.add('fa-times'),front.vars.markRead='chapter',front.vars.markReadStorySelector.target.classList.remove('hideSoft')):(t.classList.add('fa-check'),t.classList.remove('fa-times'),front.vars.markRead='all',front.vars.markReadStorySelector.target.classList.add('hideSoft'))},front.handler.menu.resetStorage=(e)=>{front.methods.confirm(e.currentTarget,()=>{front.methods.resetStorage(),front.methods.resetCache()},'resetStorage')},front.handler.menu.show=()=>{front.el.menu.classList.toggle('show')},front.handler.menu.toggleMinimizedSound=(e)=>{let t,r={currentTarget:{parentElement:e.currentTarget.parentElement}};(front.vars.notificationSettings.silent===void 0||front.vars.notificationSettings.vibrate===void 0)&&(t=new front.proto.busyLayer({target:r.currentTarget.parentElement,message:'Loading'}),t.init(),front.serverActions.getNotificationSettings().then((e)=>{front.vars.notificationSettings=JSON.parse(e),front.vars.notificationSettings.silent&&(front.el.toggleSound.classList.remove('fa-check'),front.el.toggleSound.classList.add('fa-times')),front.vars.notificationSettings.vibrate||(front.el.toggleVibrate.classList.remove('fa-check'),front.el.toggleVibrate.classList.add('fa-times')),t.remove()}).catch(()=>{front.handler.menu.toggleMinimized(r),t.remove()})),front.handler.menu.toggleMinimized(r)},front.handler.menu.toggleMinimizedSubscriptions=(e)=>{if(!front.vars.subscriptionList.length){let t=new front.proto.busyLayer({target:e.currentTarget.parentElement,message:'Loading'});t.init(),front.createSubscriptionList(front.serverActions.getSubscriptionList(),t)}front.handler.menu.toggleMinimized(e)},front.handler.menu.toggleMinimized=(e)=>{const t=e.currentTarget.parentElement;t.classList.toggle('minimized'),t.classList.toggle('expanded')},front.handler.menu.toggleSound=(e)=>{let t=e.currentTarget,r=new front.proto.busyLayer({target:front.el.sound,message:'Loading'});r.init(),t.classList.contains('fa-check')?(t.classList.remove('fa-check'),t.classList.add('fa-times'),front.vars.notificationSettings.silent=1):(t.classList.add('fa-check'),t.classList.remove('fa-times'),front.vars.notificationSettings.silent=0),front.serverActions.setNotificationSettings().then(r.remove)},front.handler.menu.toggleVibrate=(e)=>{let t=e.currentTarget,r=new front.proto.busyLayer({target:front.el.sound,message:'Loading'});r.init(),t.classList.contains('fa-check')?(t.classList.remove('fa-check'),t.classList.add('fa-times'),front.vars.notificationSettings.vibrate=0):(t.classList.add('fa-check'),t.classList.remove('fa-times'),front.vars.notificationSettings.vibrate=1),front.serverActions.setNotificationSettings().then(r.remove)},front.handler.menu.toggleSubscription=(e)=>{const t=e.target;if(t.id){let e=document.querySelector('.'+t.id+'.toggleButton');e&&(front.serverActions.subscribe(t.id,e.classList.contains('fa-check')),e.classList.toggle('fa-times'),e.classList.toggle('fa-check'))}},front.handler.focus=()=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:'resetBase'}),front.methods.getChapterList()},front.handler.login=(e)=>{var t=document.getElementById('passwordInput'),r=document.getElementById('userInput');e.stopPropagation(),e.preventDefault(),front.methods.login(r.value,t.value)},front.handler.message=()=>{front.methods.getChapterList()},front.handler.reload=(e)=>{e.target.classList.add('fa-spin'),front.methods.getChapterList().then(()=>{e.target.classList.remove('fa-spin')}).catch((e)=>console.warn('reload error',e))},front.handler.undoMarkRead=(e)=>{var t=front.vars.reference[e],r=front.vars.createdStoryElem[t.short],s=front.methods.getCurrentVisibleChapter();front.el.body.classList.contains('readerMode')&&front.vars.currentStory!==t.short&&front.handler.reader.toggleChapter(front.vars.currentStory),front.el.menu.classList.contains('show')&&front.el.menu.classList.remove('show'),null!==s&&s.classList.add('hiddenChapter'),t.elem.classList.remove('hidden'),t.elem.classList.remove('hiddenChapter'),t.hidden=!1,r.counter.count++,r.counter.counter.innerHTML=r.counter.count,front.methods.unmarkRead(t),front.methods.checkAllChaptersRead(t.short),r.content.classList.contains('hidden')&&front.handler.reader.toggleChapter(t.short)},front.methods.applyDeleteStash=()=>{const e=front.vars.reference,t=front.vars.deleteStash;t.forEach((t)=>{e&&e[t]&&e[t].elem&&(e[t].elem.remove(),delete e[t])})},front.methods.checkAllChaptersRead=(e)=>{const t=front.vars.createdStoryElem[e];return 0===t.chapters.filter((e)=>{return!e.read}).length?(t.menu.classList.add('hidden','allRead'),!0):t.menu.classList.contains('allRead')?(t.menu.classList.remove('hidden','allRead'),!1):void 0},front.methods.checkForToken=()=>{let e,t=localStorage.jwt,r=t&&'string'==typeof t?t.split('.')[1]:void 0;r&&(e=atob(r),front.vars.user=JSON.parse(e),front.el.reader.classList.remove('hideSoft'),front.el.menu.classList.remove('hideSoft'),front.el.body.classList.remove('readerMode'),front.el.body.classList.add('menuMode'),front.vars.jwt=t,navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:'newJWT',jwt:t})}).catch((e)=>console.warn('checkForToken error',e)),front.initAfterLogin(),document.getElementById('loginFrame').classList.add('hidden'),document.getElementById('loginForm').classList.add('hidden'))},front.methods.checkStoriesRead=()=>{let e=Array.from(front.el.readerList.children).filter((e)=>{if(!e.classList.contains('allRead'))return!0});return front.el.message.innerText=0===e.length?'All Read!':'',e},front.methods.changeLoadingPriority=(e)=>{front.vars.newLoadingList=front.vars.currentLoadingList.sort((t,r)=>{return t.short===e&&r.short===e?parseInt(t.Chapter.toString().replace('.','0000'))-parseInt(r.Chapter.toString().replace('.','0000')):t.short===e?-1:r.short===e?1:0}),front.vars.loadingPriorityChanged=!0},front.methods.confirm=(e,t,r,s)=>{e.classList.contains('confirm')?(t(s),clearInterval(front.vars.confirmTimers[r]),e.classList.remove('confirm')):(e.classList.add('confirm'),front.vars.confirmTimers[r]=setInterval(()=>{e.classList.remove('confirm'),clearInterval(front.vars.confirmTimers[r])},5e3))},front.methods.defaultRequestHandling=(e,t,r)=>{if(4===e.readyState)switch(e.status){case 200:t(e.response);break;case 279:t(e.response);break;case 401:front.methods.logout(),r();break;default:r();}},front.methods.generateMarkReadMessage=(e)=>{front.vars.deleteStash.push(e),front.vars.undoMessage!==void 0&&front.vars.undoMessage.f!==void 0&&!0===front.vars.undoMessage.f.exists()?(front.vars.undoMessage.e.message.innerHTML=front.vars.undoMessage.e.message.innerHTML.replace('onclick="','onclick="front.handler.undoMarkRead(\''+e+'\');'),front.vars.undoMessage.f.resetTimer()):(front.vars.undoMessage=new front.proto.message({closeTimer:1e4,messageText:'<a href="#" onclick="front.handler.undoMarkRead(\''+e+'\');front.vars.deleteStash=[];front.vars.undoMessage.f.destroy(); return false">Undo</a> the mark read?'}),front.vars.undoMessage.f.onDestroy=front.methods.applyDeleteStash)},front.methods.getChapter=(e,t)=>{let r=e,s=front.vars.createdStoryElem;return new Promise((a)=>{if(0<e.length){let o,n=(i)=>{let d=r[i];front.vars.currentLoadingList=e.slice(i-1),o!==d.short&&(!s[d.short]&&front.methods.initChapterContainer(d.short),s[d.short].icon.className='loadingIcon fa fa-cog fa-spin',s[o]&&(s[o].icon.className='loadingIcon fa fa-check complete'),o=d.short),front.vars.loadingPriorityChanged&&front.vars.currentLoadingList.length&&(front.vars.loadingPriorityChanged=!1,front.vars.currentLoadingList.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).forEach((e)=>s[e].icon.classList.add('hidden')),r=front.vars.newLoadingList,i=0,front.vars.newLoadingList.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).forEach((e)=>s[e].icon.className='loadingIcon fa fa-hourglass-1'),s[front.vars.newLoadingList[0].short].icon.className='loadingIcon fa fa-cog fa-spin'),'undefined'!=typeof d.short&&'undefined'!=typeof d.Chapter&&(front.vars.reference[d.short+d.Chapter]===void 0?front.serverActions.requestChapter(d,t).then((e)=>{d.Content=e,front.chapters.push(d),d.read=!1,front.methods.renderChapter(d)}).catch(()=>{}).then(()=>{i++,front.vars.loadingState[d.short].state++,i<r.length?n(i):(s[d.short].icon.className='loadingIcon fa fa-check complete',a())}).catch((e)=>console.warn('getChapter error',e)):(front.methods.renderChapter(d),i++,front.vars.loadingState[d.short].state++,i<r.length?n(i):(s[d.short].icon.className='loadingIcon fa fa-check complete',a())))};n(0)}else a()}).catch((e)=>{console.log(e)}).then(()=>{front.methods.checkStoriesRead(),front.vars.markReadStorySelector&&front.vars.markReadStorySelector.newData(Array.from(new Set(front.chapters.map((e)=>e.short))))}).catch((e)=>console.warn('getChapter error',e))},front.methods.getChapterList=()=>{return front.serverActions.getChapterList().catch((e)=>{console.log(e)})},front.methods.getClosestChapter=(e)=>{const t=front.vars.createdStoryElem;let r;return r=t[e.short].chapters.filter((t)=>{return!!(parseInt(t.Chapter.toString().replace('.','0000'))>parseInt(e.Chapter.toString().replace('.','0000')))}),!!(0<r.length)&&(r.sort((e,t)=>{return parseInt(e.Chapter.toString().replace('.','0000'))-parseInt(t.Chapter.toString().replace('.','0000'))}),r[0].elem)},front.methods.getCurrentVisibleChapter=()=>{for(var e=document.elementFromPoint(front.el.body.offsetWidth/2,front.el.body.offsetHeight/2);null!==e&&!e.classList.contains('chapter');)e=e.parentElement;return e},front.methods.hideItem=(e)=>{if(void 0!==e&&e.read&&!e.hidden){let t=front.vars.createdStoryElem[e.short];return t.counter.count--,t.counter.counter.innerHTML=t.counter.count,e.elem.classList.add('hidden'),e.hidden=!0,front.methods.generateMarkReadMessage(e.short+e.Chapter),front.methods.checkAllChaptersRead(e.short),!0}return!1},front.methods.initChapterContainer=(e)=>{const t=front.vars.createdStoryElem;let r;t[e]===void 0&&(t[e]={menu:document.createElement('li')},t[e].content=document.createElement('ul'),t[e].menu.innerHTML='<p class="head" title="'+front.vars.shortNameMap[e]+'">'+e+'<span class="counterFrame"><span class="counterIcon fa fa-files-o"></span><span class="iconCounter">0</span></span><span class="loadingIcon hidden"></span></p>',r=Array.from(t[e].menu.querySelectorAll('.loadingIcon, counterFrame, .counterIcon, .iconCounter')),t[e].icon=r.filter((t)=>t.classList.contains('loadingIcon'))[0],t[e].counter={frame:r.filter((t)=>t.classList.contains('counterFrame'))[0],icon:r.filter((t)=>t.classList.contains('counterIcon'))[0],counter:r.filter((t)=>t.classList.contains('iconCounter'))[0],count:0},t[e].menu.id=e,t[e].content.className='sublist hidden',front.el.readerList.appendChild(t[e].menu),t[e].menu.appendChild(t[e].content),t[e].menu.children[0].addEventListener('click',front.handler.reader.toggleChapter.bind(null,e),!1),t[e].content.addEventListener('touchend',front.handler.content.touchend,!1),t[e].content.addEventListener('touchstart',front.handler.content.touchstart,!1),t[e].chapters=[])},front.methods.loadChapterList=(e,t,r)=>{var s,a=[];const o=front.vars.fullChapterList;front.vars.loadingState[e]={state:0},s=o[e].chapters.slice(o[e].chapters.indexOf(t),o[e].chapters.indexOf(r)+1);for(var n=0;n<s.length;n++)a.push({short:e,Chapter:s[n],read:!1});front.methods.getChapter(a,!0)},front.methods.login=(e,t,r)=>{let s=r||'Login-Error, Error Code: ';return front.vars.busy=new front.proto.busyLayer,front.vars.busy.init(),front.vars.loggingOut=!1,front.serverActions.login(e,t).then((e)=>{front.vars.busy.busyText.innerHTML='Initializing Service Worker',front.vars.user=JSON.parse(atob(e.token.split('.')[1])),front.vars.jwt=e.token,localStorage.jwt=e.token,front.vars.reloadTimer=setInterval(()=>location.reload(),5e3),navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.controller&&(clearInterval(front.vars.reloadTimer),navigator.serviceWorker.controller.postMessage({type:'newJWT',jwt:e.token}))}).then(()=>{front.vars.busy.busyText.innerHTML='Preparing application',document.getElementById('loginFrame').classList.add('hidden'),document.getElementById('loginForm').classList.add('hidden'),front.el.reader.classList.remove('hideSoft'),front.el.menu.classList.remove('hideSoft'),front.el.body.classList.remove('readerMode'),front.el.body.classList.add('menuMode'),front.vars.busy.remove()}).then(front.initAfterLogin).catch((e)=>console.warn('login error',e))}).catch((e)=>{void 0!==front.vars.loginMessage&&void 0!==front.vars.loginMessage.f&&!0===front.vars.loginMessage.f.exists()?(front.vars.loginMessage.e.message.innerHTML='<p>'+s+e+'</p>',front.vars.loginMessage.f.resetTimer()):front.vars.loginMessage=new front.proto.message({closeTimer:5e3,messageText:'<p>'+s+e+'</p>'}),front.vars.loggedin&&front.methods.logout(),front.vars.busy.remove()})},front.methods.logout=()=>{front.vars.loggingOut||(front.vars.loggingOut=!0,localStorage.removeItem('jwt'),front.el.body.className='loginMode',clearInterval(front.checkServerTimer),front.vars.setupStatus='unregistered',document.getElementById('loginFrame').classList.remove('hidden'),document.getElementById('loginForm').classList.remove('hidden'),front.el.reader.classList.add('hideSoft'),front.el.menu.classList.add('hideSoft'),front.el.adminButton.classList.add('hidden'),front.el.reader.firstElementChild.innerHTML='',front.chapters=[],front.vars.createdStoryElem=[],front.vars.currentStory='',front.vars.newChapterList=void 0,front.vars.refreshedChapterList=[],front.vars.reference=[],front.vars.user='',front.vars.loggedin=!1,front.vars.undoMessage&&front.vars.undoMessage.f&&front.vars.undoMessage.destroy&&front.vars.undoMessage.f.destroy(),navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:'deleteJWT'})}).catch((e)=>console.warn('logout error',e)),front.methods.unregisterSubscription())},front.methods.markRead=(e)=>{front.vars.refreshedChapterList=front.vars.refreshedChapterList.filter((t)=>t.short===e.short&&t.Chapter===e.Chapter),e.read=!0,front.serverActions.markRead(e).catch(()=>{setTimeout(()=>{front.methods.markRead(e)},3e4)})},front.methods.menuMode=(e)=>{if(e){const t=front.vars.createdStoryElem[e];front.methods.checkAllChaptersRead(e),t.content.classList.add('hidden')}front.vars.currentStory='',front.el.body.classList.remove('readerMode'),front.el.body.classList.add('menuMode'),front.el.refreshButton.classList.remove('hidden'),front.el.markReadButton.classList.add('hidden'),unreadStories=front.methods.checkStoriesRead(),unreadStories.forEach((e)=>e.classList.remove('hidden')),front.vars.freshList&&(front.methods.refreshedChapterList(),front.vars.freshList=!1)},front.methods.newChapterList=()=>{let e,t=front.vars.createdStoryElem;0<front.vars.newChapterList.length?(front.el.message.innerText='',front.vars.newChapterList.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).sort().forEach(front.methods.initChapterContainer),front.vars.newChapterList=front.methods.sortChapters(front.vars.newChapterList),e=front.methods.sortChaptersForLoading(front.vars.newChapterList),e.firstChapters.forEach((e)=>front.vars.loadingState[e.short]={state:0}),front.methods.getChapter(e.storedChapters).then(()=>{return e.firstChapters.forEach((e,r)=>{t[e.short].icon.className=r?'loadingIcon fa fa-hourglass-1':'loadingIcon fa fa-cog fa-spin'}),front.methods.getChapter(e.firstChapters)}).then(()=>{return e.otherChapters.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).forEach((e,r)=>{t[e].icon.className=r?'loadingIcon fa fa-hourglass-2':'loadingIcon fa fa-cog fa-spin'}),front.methods.getChapter(e.otherChapters)}).catch((e)=>console.warn('newChapterList error',e))):front.el.message.innerText='All Read!'},front.methods.refreshedChapterList=()=>{let e,t,r,s=front.vars.createdStoryElem;if(front.el.body.classList.contains('menuMode')){for(e in s)s[e].counter.count=0,s[e].menu.classList.add('hidden','allRead'),s[e].chapters.forEach((e)=>{e.elem.classList.add('hidden'),e.hidden=!0});0<front.vars.refreshedChapterList.length?(front.el.message.innerText='',r=front.vars.refreshedChapterList.filter((e)=>!(front.vars.reference[e.short+e.Chapter]&&front.vars.reference[e.short+e.Chapter].read)),r.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).sort().forEach(front.methods.initChapterContainer),r=front.methods.sortChapters(r),t=front.methods.sortChaptersForLoading(r),t.firstChapters.forEach((e)=>front.vars.loadingState[e.short]={state:0}),front.methods.getChapter(t.storedChapters).then(()=>{return t.firstChapters.forEach((e,t)=>{s[e.short].icon.className=t?'loadingIcon fa fa-hourglass-1':'loadingIcon fa fa-cog fa-spin'}),front.methods.getChapter(t.firstChapters)}).then(()=>{return t.otherChapters.reduce((e,t)=>{return e.includes(t.short)||e.push(t.short),e},[]).forEach((e,t)=>{s[e].icon.className=t?'loadingIcon fa fa-hourglass-2':'loadingIcon fa fa-cog fa-spin'}),front.methods.getChapter(t.otherChapters)}).catch((e)=>console.warn('newChapterList error',e))):front.el.message.innerText='All Read!'}else front.vars.freshList=!0},front.methods.renderChapter=(e)=>{const t=front.vars.createdStoryElem,r=front.vars.reference[e.short+e.Chapter];let s;t[e.short]===void 0&&front.methods.initChapterContainer(short),r===void 0||r.elem===void 0?(t[e.short].counter.count++,t[e.short].counter.counter.innerHTML=t[e.short].counter.count,e.elem=document.createElement('li'),e.elem.id=e.short+e.Chapter,e.elem.className='chapter hiddenChapter',e.elem.innerHTML=e.Content,e.hidden=!1,front.vars.reference[e.short+e.Chapter]=e,s=front.methods.getClosestChapter(e),s?t[e.short].content.insertBefore(e.elem,s):t[e.short].content.appendChild(e.elem),t[e.short].chapters.push(e),e.elem.addEventListener('scroll',front.handler.content.scroll,!1),front.methods.checkAllChaptersRead(e.short)):(r.hidden&&(t[e.short].counter.count++,t[e.short].counter.counter.innerHTML=t[e.short].counter.count),r.read=!1,r.hidden=!1,null===r.elem.parentElement&&(s=front.methods.getClosestChapter(e),s?t[e.short].content.insertBefore(r.elem,s):t[e.short].content.appendChild(r.elem)),t[e.short].menu.classList.remove('allRead',front.el.reader.classList.contains('readerMode')?'nonExistingClass':'hidden'),r.elem.classList.remove('hidden'),front.methods.checkAllChaptersRead(e.short)),front.el.reader.classList.contains('readerMode')&&t[e.short].menu.classList.add('hidden')},front.methods.resetCache=()=>{navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:'clearCache'})}).catch((e)=>console.warn('logout error',e))},front.methods.resetStorage=()=>{let e=localStorage.jwt;localStorage.clear(),localStorage.jwt=e},front.methods.sortChapters=(e)=>{return e.sort((e,t)=>{return e.short===t.short?parseInt(e.Chapter.toString().replace('.','0000'))-parseInt(t.Chapter.toString().replace('.','0000')):e.short<t.short?-1:e.short>t.short?1:0})},front.methods.sortChaptersForLoading=(e)=>{let t=front.methods.sortChapters(e),r=Object.keys(localStorage),s={};return t.reduce((e,t)=>{return r.includes(t.short+t.Chapter)?void 0===s[t.short]?(s[t.short]=!0,e.firstChapters.push(t),e.storedChapters.push(t)):e.storedChapters.push(t):void 0===s[t.short]?(s[t.short]=!0,e.firstChapters.push(t)):e.otherChapters.push(t),e},{firstChapters:[],storedChapters:[],otherChapters:[]})},front.methods.unmarkRead=(e)=>{e.read&&(e.read=!1,front.serverActions.markRead(e).catch(()=>{e.read=!0}))},front.methods.unregisterSubscription=()=>{navigator.serviceWorker.ready.then((e)=>{e.pushManager.getSubscription().then((e)=>{e&&front.serverActions.messagingKey(e,!0)})}).catch((e)=>console.warn('unregisterSubscription error',e))},front.proto.busyLayer=function(e){const t=this;let r=0;t.options={},t.init=()=>{t.setOptions(e),t.render(),t.append(t.options.target)},t.setOptions=(e)=>{'object'!=typeof e&&(e={}),t.options.message=e.message||'Logging in',t.options.target=e.target||document.querySelector('body')},t.render=()=>{let e=document.createElement('div');t.busyLayer=document.createElement('div'),t.busyText=document.createElement('p'),t.busyPoints=document.createElement('p'),t.busyLayer.classList.add('busy'),t.busyLayer.appendChild(e),e.appendChild(t.busyText),e.appendChild(t.busyPoints),t.busyText.innerHTML=t.options.message,t.busyPoints.innerHTML='.'},t.animate=()=>{3>r?(t.busyPoints.innerHTML+='.',r++):(r=0,t.busyPoints.innerHTML='.')},t.remove=()=>{t.busyLayer.remove(),clearInterval(t.timer)},t.append=(e)=>{e.appendChild(t.busyLayer),t.timer=setInterval(t.animate,500)}},front.proto.message=function(e){const t=this;t.options={},t.f={},t.e={},t.m={},e===void 0&&(e={}),t.f.init=()=>{t.f.setOptions(),t.f.render(),0<t.options.closeTimer&&(t.m.closeTimer=setInterval(()=>{t.f.destroy()},parseInt(t.options.closeTimer)))},t.f.render=()=>{t.e.messageBody=document.createElement('div'),t.e.closeButton=document.createElement('span'),t.e.message=document.createElement('p'),t.e.messageBody.className='message messageBody flexCol',t.e.closeButton.className='message closeButton fa fa-times',t.e.message.innerHTML=t.options.messageText,t.options.target.appendChild(t.e.messageBody),t.e.messageBody.appendChild(t.e.message),t.e.messageBody.appendChild(t.e.closeButton),t.e.closeButton.addEventListener('click',t.f.destroy),t.body.classList.add('messageActive')},t.f.setOptions=()=>{t.options.messageText=e.messageText||'No Text provided!',t.options.closeTimer=e.closeTimer||0,t.options.target=e.target||document.querySelector('body'),t.body=document.querySelector('body')},t.f.exists=()=>{return!0},t.f.resetTimer=()=>{clearInterval(t.m.closeTimer),0<t.options.closeTimer&&(t.m.closeTimer=setInterval(()=>{t.f.destroy()},parseInt(t.options.closeTimer)))},t.f.onDestroy=()=>{},t.f.destroy=()=>{t.f.onDestroy(),clearInterval(t.m.closeTimer),t.e.messageBody.remove(),t.body.classList.remove('messageActive'),t.e=void 0,t.options=void 0,t.f=void 0,t.m=void 0},t.f.init()},front.proto.picker=function(e,t){var r=Math.round;const s=this;s.options={},s.init=()=>{s._setOptions()&&(s._render(),s._registerListeners(),s.initialized=!0,s.currentId=s.list.children[0].innerText,s.cb!==void 0&&s.cb(s.currentPosition,s.currentId))},s._setOptions=()=>{return(void 0!==e.target||void 0!==e.data)&&(s.target=e.target,s.cb=t,s.currentPosition=0,s.options.factor=e.factor||1,s.options.frameClass=e.frameClass||'frame',s.options.tagClass=e.tagClass||'tag',s.options.listClass=e.listClass||'list',s.options.tag=e.tag||'',s.options.dataprop=e.dataprop||!1,s.options.data=e.data,!0)},s._render=()=>{s.frame=document.createElement('div'),s.tag=document.createElement('span'),s.list=document.createElement('ul'),s.frame.className=s.options.frameClass,s.tag.className=s.options.tagClass,s.list.className=s.options.listClass,s.target.appendChild(s.frame),s.frame.appendChild(s.tag),s.frame.appendChild(s.list),s.tag.innerText=s.options.tag,s._renderList()},s._renderList=()=>{s.options.data.forEach((e)=>{const t=document.createElement('li');t.innerText=s.options.dataprop?e[s.options.dataprop]:e,s.list.appendChild(t)}),s.list.children[0]&&(s.list.children[0].style.marginTop='0px')},s._emptyList=()=>{s.list.innerHTML=''},s._registerListeners=()=>{s.list.addEventListener('touchstart',s._touchstart,!1),s.list.addEventListener('touchmove',s._touchmove,!1),s.list.addEventListener('touchend',s._touchend,!1),s.list.addEventListener('mousedown',s._mousedown,!1)},s._mousedown=(e)=>{e.stopPropagation(),e.preventDefault(),s.startTrans=s.getMarginTop(),s.startX=parseInt(e.clientX),s.startY=parseInt(e.clientY),document.querySelector('body').addEventListener('mousemove',s._mousemove,!1),document.querySelector('body').addEventListener('mouseup',s._mouseup,!1),document.querySelector('body').addEventListener('mouseout',s._mouseout,!1)},s._mouseup=(e)=>{e.stopPropagation(),e.preventDefault();const t=-r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height);t!==s.currentPosition&&s.cb!==void 0&&(s.currentPosition=t,s.currentId=s.list.children[-r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height)].innerText,s.cb(t,s.currentId)),document.querySelector('body').removeEventListener('mousemove',s._mousemove),document.querySelector('body').removeEventListener('mouseup',s._mouseup),document.querySelector('body').removeEventListener('mouseout',s._mouseout)},s._mouseout=(e)=>{e.relatedTarget&&'HTML'!==e.relatedTarget.nodeName||s._mouseup(e)},s._mousemove=(e)=>{e.stopPropagation(),e.preventDefault(),s.currentY=parseInt(e.clientY),s._moveFunction(e.clientY)},s._moveFunction=(e)=>{var t=s.startY-s.currentY,a=s.list.children[0].getBoundingClientRect().height,o=-s.list.scrollHeight+s.getMarginTop()+2*a,n=4*t/window.innerHeight,i=-(n*n*n*s.options.factor)*-o+s.startTrans,d=r(i/a)*a,l=r(o/a)*a;0>i&&d>=l?s.list.children[0].style.marginTop=d+'px':(s.list.children[0].style.marginTop=0<=i?'0':l+'px',s.startY=parseInt(e),s.startTrans=s.getMarginTop())},s._touchstart=(e)=>{e.stopPropagation(),e.preventDefault(),s.startTrans=s.getMarginTop(),s.startX=parseInt(e.touches[0].clientX),s.startY=parseInt(e.touches[0].clientY)},s._touchmove=(e)=>{e.stopPropagation(),e.preventDefault(),s.currentY=parseInt(e.touches[0].clientY),s._moveFunction(e.touches[0].clientY)},s._touchend=(e)=>{e.stopPropagation(),e.preventDefault();const t=-r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height);t!==s.currentPosition&&s.cb!==void 0&&(s.currentPosition=t,s.currentId=s.list.children[-r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height)].innerText,s.cb(t,s.currentId))},s.newData=(t,r)=>{s.initialized?(s.options.dataprop=r||!1,s.options.data=t,s._emptyList(),s._renderList()):0<t.length&&(e.dataprop=r||!1,e.data=t,s.init())},s.goto=(e)=>{return void 0===e||isNaN(parseInt(e))||0>=e&&e>=s.options.data.length?!1:(s.list.children[0].style.marginTop=-parseInt(e)*s.list.children[0].getBoundingClientRect().height+'px',!0)},s.getMarginTop=()=>{var e=parseInt(s.list.children[0].style.marginTop);return isNaN(e)?0:e},s.getValue=()=>{return s.list.children[-r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height)].innerText},s.getPosition=()=>{return r(s.getMarginTop()/s.list.children[0].getBoundingClientRect().height)},s._setOptions(),(0<s.options.data.length||s.options.target!==void 0)&&s.init()},front.serverActions.getChapterList=()=>{const e=new XMLHttpRequest,t=document.querySelector('.connection');let r;return new Promise((s,a)=>{e.open('GET',front.options.server+'/api/getNewChapterList',!0),e.setRequestHeader('Cache-Control','no-Cache'),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{switch(e.readyState){case 4:let o=new Date,n=o.getHours()+':'+o.getMinutes()+':'+o.getSeconds();n=n.replace(/([:]?\D)(\d)\b/g,'$10$2'),t.innerHTML='Last Update: '+n,200===e.status?(front.vars.newChapterList===void 0?(r=JSON.parse(e.response),front.vars.newChapterList=r.chapterList,front.vars.shortNameMap=r.chapterNameMap,front.vars.chapterListVersion=front.vars.newChapterList&&0<front.vars.newChapterList.length?front.vars.newChapterList[0].new:0,front.methods.newChapterList()):(front.vars.refreshedChapterList=JSON.parse(e.response).chapterList,front.vars.refreshedChapterList&&0<front.vars.refreshedChapterList.length&&front.vars.refreshedChapterList[0].new>front.vars.chapterListVersion?(front.vars.chapterListVersion=front.vars.refreshedChapterList[0].new,front.methods.refreshedChapterList()):front.vars.refreshedChapterList&&0===front.vars.refreshedChapterList.length&&front.methods.refreshedChapterList()),s()):(401===e.status&&(front.methods.logout(),a()),s());}},e.onerror=()=>{s()},e.send()})},front.serverActions.getFullChapterList=()=>{const e=new XMLHttpRequest;return new Promise((t,r)=>{e.open('GET',front.options.server+'/api/requestFullChapterList',!0),e.setRequestHeader('Cache-Control','no-Cache'),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{switch(e.readyState){case 2:break;case 4:200===e.status?(front.vars.fullChapterList=JSON.parse(e.response.replace(/{"Chapter":(.*?)}/g,'$1')),front.vars.fullChapterList.forEach((e)=>{e.chapters.sort((e,t)=>{if(-1===e.toString().indexOf('.'))return parseInt(e)-parseInt(t);return-1===e.toString().indexOf('.')?void 0:e.split('.')[0]===t.split('.')[0]?parseInt(e.split('.')[1])-parseInt(t.split('.')[1]):parseInt(e.split('.')[0])-parseInt(t.split('.')[0])}),front.vars.fullChapterList[e.short]=e,front.vars.fullChapterList[e.short].chapters=front.vars.fullChapterList[e.short].chapters.map((e)=>{return e.toString()})}),t()):(401===e.status&&front.methods.logout(),r());}},e.send()})},front.serverActions.getStatus=()=>{const e=new XMLHttpRequest,t=front.options.server+'/api/status';return new Promise((r,s)=>{e.open('GET',t,!0),e.setRequestHeader('Cache-Control','no-Cache'),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status?(front.vars.serverStatus=JSON.parse(e.response),r()):s(e.status))},e.send()})},front.serverActions.getSubscriptionList=()=>{const e=new XMLHttpRequest,t=front.options.server+'/api/subscribeSeries';return new Promise((r,s)=>{e.open('GET',t,!0),e.setRequestHeader('Cache-Control','no-Cache'),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status?(front.vars.subscriptionList=JSON.parse(e.response),r()):s(e.status))},e.send()})},front.serverActions.login=(e,t)=>{const r=new XMLHttpRequest,s=front.options.server+'/login';return new Promise((a,o)=>{r.open('POST',s,!0),r.setRequestHeader('Content-type','application/x-www-form-urlencoded'),r.onreadystatechange=()=>{4===r.readyState&&(200===r.status?a(JSON.parse(r.response)):o(r.status))},r.send('user='+e+'&password='+t)})},front.serverActions.markAllRead=(e)=>{const t=new XMLHttpRequest,r=front.options.server+'/api/markAllRead'+e;return new Promise((e,s)=>{t.open('PUT',r,!0),t.setRequestHeader('jwt',front.vars.jwt),t.onreadystatechange=()=>{front.methods.defaultRequestHandling(t,e,s),front.handler.reload()},t.send()})},front.serverActions.markRead=(e)=>{const t=new XMLHttpRequest,r=front.options.server+'/api/markRead?short='+e.short+'&chapter='+e.Chapter+'&read='+e.read;return new Promise((e,s)=>{t.open('PUT',r,!0),t.setRequestHeader('jwt',front.vars.jwt),t.onreadystatechange=()=>{front.methods.defaultRequestHandling(t,e,s)},t.send()})},front.serverActions.markNew=(e)=>{const t=new XMLHttpRequest,r=front.options.server+'/api/markNew?short='+e.short+'&chapter='+e.Chapter+'&read='+e.read;return new Promise((e,s)=>{t.open('PUT',r,!0),t.setRequestHeader('jwt',front.vars.jwt),t.onreadystatechange=()=>{front.methods.defaultRequestHandling(t,e,s)},t.send()})},front.serverActions.messagingKey=(e,t)=>{const r=new XMLHttpRequest,s=front.options.server+'/api/messageKey',a=JSON.stringify(e),o=t?'DELETE':'POST';return new Promise((e,n)=>{r.open(o,s,!0),r.setRequestHeader('jwt',front.vars.jwt),r.setRequestHeader('Content-Type','application/json'),r.onreadystatechange=()=>{t?front.methods.defaultRequestHandling(r,e,e):front.methods.defaultRequestHandling(r,e,n)},r.send(a)})},front.serverActions.getNewToken=()=>{const e=new XMLHttpRequest,t=front.options.server+'/refreshToken';return new Promise((r,s)=>{e.open('GET',t,!0),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{if(4===e.readyState)switch(e.status){case 200:case 279:let t=JSON.parse(e.response);front.vars.user=JSON.parse(atob(t.token.split('.')[1])),front.vars.jwt=t.token,localStorage.jwt=t.token,navigator.serviceWorker.ready.then(()=>{navigator.serviceWorker.controller&&(clearInterval(front.vars.reloadTimer),navigator.serviceWorker.controller.postMessage({type:'newJWT',jwt:t.token}))}),r();break;case 401:front.methods.logout(),s();break;default:s();}},e.send()})},front.serverActions.setNotificationSettings=()=>{const e=new XMLHttpRequest,t=front.options.server+'/api/notificationSettings';return new Promise((r,s)=>{e.open('POST',t,!0),e.setRequestHeader('Content-type','application/x-www-form-urlencoded'),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{front.methods.defaultRequestHandling(e,r,s)},e.send('silent='+front.vars.notificationSettings.silent+'&vibrate='+front.vars.notificationSettings.vibrate)})},front.serverActions.getNotificationSettings=()=>{const e=new XMLHttpRequest,t=front.options.server+'/api/notificationSettings';return new Promise((r,s)=>{e.open('GET',t,!0),e.setRequestHeader('jwt',front.vars.jwt),e.onreadystatechange=()=>{front.methods.defaultRequestHandling(e,r,s)},e.send()})},front.serverActions.requestChapter=(e,t)=>{const r=new XMLHttpRequest,s=front.options.server+'/api/requestChapter?short='+e.short+'&chapter='+e.Chapter+'&addToNew='+(!!t&&t);let a;return new Promise((o,n)=>{localStorage[e.short+e.Chapter]!==void 0&&1e3<=localStorage[e.short+e.Chapter].length?(t&&front.serverActions.markNew(e).catch((e)=>console.log(e)),o(localStorage[e.short+e.Chapter])):(r.open('GET',s,!0),r.setRequestHeader('jwt',front.vars.jwt),r.setRequestHeader('Content-type','application/x-www-form-urlencoded'),r.addEventListener('progress',()=>{}),r.onreadystatechange=()=>{switch(r.readyState){case 2:break;case 4:if(200===r.status){localStorage.timestamps?(a=JSON.parse(localStorage.timestamps),a.push({timestamp:new Date().getTime(),key:e.short+e.Chapter}),localStorage.timestamps=JSON.stringify(a)):localStorage.timestamps=JSON.stringify([{timestamp:new Date().getTime(),key:e.short+e.Chapter}]);try{localStorage[e.short+e.Chapter]=r.responseText}catch(t){}o(r.responseText)}else 401===r.status&&front.methods.logout(),n();}},r.send())})},front.serverActions.subscribe=(e,t)=>{const r=new XMLHttpRequest,s=front.options.server+'/api/subscribeSeries',a=t?'DELETE':'POST';return new Promise((t,o)=>{r.open(a,s,!0),r.setRequestHeader('jwt',front.vars.jwt),r.setRequestHeader('Content-type','application/x-www-form-urlencoded'),r.onreadystatechange=()=>{front.methods.defaultRequestHandling(r,t,o)},r.send('short='+e)})},front.init=()=>{front.methods.checkForToken(),document.querySelector('#loginButton').addEventListener('click',front.handler.login)},front.initAfterLogin=()=>{let e,t,r,s=new Date().getTime();front.registerServiceWorker(),'initialized'===front.vars.setupStatus?front.methods.getChapterList():(front.vars.setupStatus='initialized',r=front.serverActions.getChapterList(),front.setupMarkReadSliders(r),front.registerListeners(),front.initLoadingCircle([r]),r.then(()=>{t=front.vars.newChapterList.reduce((e,t)=>{return e.push(t.short+t.Chapter),e},[]),localStorage.timestamps&&(e=JSON.parse(localStorage.timestamps),e=e.filter((e)=>{return e.timestamp+6.048e8<s&&!t.includes(e.key)?(localStorage[e.key]=void 0,!1):!0}),localStorage.timestamps=JSON.stringify(e))})),'admin'===front.vars.user.role&&(document.querySelector('#admin').classList.remove('hidden'),front.el.statusRow.classList.remove('hidden'),front.serverActions.getStatus().then(front.initStatus)),front.vars.loggedin=!0},front.initLoadingCircle=(e)=>{let t=setTimeout(()=>{front.el.body.insertAdjacentHTML('beforeend','<div class="loadingCircle"></div><div class="loadingCircleContent">loading</div>')},1e3);Promise.all(e).then(()=>{let e=document.querySelector('.loadingCircle'),r=document.querySelector('.loadingCircleContent');clearTimeout(t),e&&(e.remove(),r.remove())}).catch((e)=>console.log(e))},front.registerListeners=()=>{const e=front.handler,t=e.menu;document.querySelector('#markReadButton').addEventListener('click',e.content.markReadButton,!1),document.querySelector('#loadStory').firstElementChild.addEventListener('click',t.loadStory),document.querySelector('#markAllRead').firstElementChild.addEventListener('click',t.toggleMinimized),document.querySelector('#manageSubs').firstElementChild.addEventListener('click',t.toggleMinimizedSubscriptions),document.querySelector('#status').firstElementChild.addEventListener('click',t.toggleMinimized),document.querySelector('#sound').firstElementChild.addEventListener('click',t.toggleMinimizedSound),document.querySelector('#toggleSound').addEventListener('click',t.toggleSound),document.querySelector('#toggleVibrate').addEventListener('click',t.toggleVibrate),document.querySelector('#logoutButton').addEventListener('click',t.logout),document.querySelector('#reloadPageButton').addEventListener('click',t.fullReload),document.querySelector('#resetStorageButton').addEventListener('click',e.menu.resetStorage),document.querySelector('#reload').addEventListener('click',front.handler.reload),document.addEventListener('keyup',e.content.keys,!1),document.addEventListener('keydown',e.content.keys,!1),document.getElementById('menuHead').addEventListener('click',t.show),navigator.serviceWorker.addEventListener('message',e.message),document.addEventListener('visibilitychange',front.handler.focus),front.el.adminButton.addEventListener('click',front.handler.menu.gotoAdmin)},front.initStatus=()=>{let e=front.el.statusRow,t=e.querySelector('#usercount'),r=e.querySelector('#uptime'),s=e.querySelector('#inactiveList'),a=(e,t)=>`<li>${e} was last updated ${t}.</li>`;t.innerHTML=front.vars.serverStatus.usercount,r.innerHTML=front.vars.serverStatus.uptime,s.innerHTML=front.vars.serverStatus.slowUpdates.map((e)=>a(e.short,e.updated)).join('\n')},front.createSubscriptionList=(e,t)=>{const r=document.getElementById('subsList'),s=r.parentElement;e.then(()=>{r.remove(),front.vars.subscriptionList.forEach((e)=>{let t=document.createElement('li');t.innerHTML='<div class="flexRow" id="'+e.short+'"><label for="" id="'+e.short+'">'+e.short+'</label><div id="'+e.short+'" class="'+e.short+' toggleButton fa '+(e.active?'fa-check':'fa-times')+'"></div></div>',r.appendChild(t)}),s.appendChild(r),r.addEventListener('click',front.handler.menu.toggleSubscription),t.remove()}).catch((e)=>console.warn('createSubscriptionList error',e))},front.setupMarkReadSliders=(e)=>{e.then(()=>{const e=document.querySelector('#markAllReadButton');front.vars.markReadStorySelector===void 0?(front.vars.markReadStorySelector=new front.proto.picker({target:document.querySelector('#markReadStoryPicker'),frameClass:'storypicker full flexRow',tagClass:'storyTag',listClass:'story list',tag:'Select Story:',data:Array.from(new Set(front.vars.newChapterList.map((e)=>e.short)))}),e.addEventListener('click',front.handler.menu.markAllRead,!1),document.querySelector('#markAllRead .toggleButton').addEventListener('click',front.handler.menu.markAllReadToggle,!1)):front.vars.markReadStorySelector.newData(Array.from(new Set(front.vars.newChapterList.map((e)=>e.short))))}).catch((e)=>console.log(e))},front.setupLoadChapterSliders=(e,t)=>{e.then(()=>{const e=document.querySelector('#loadChapters');front.vars.loadStorySelector===void 0&&(front.vars.loadStorySelector=new front.proto.picker({target:document.querySelector('#loadStoryPicker'),frameClass:'storypicker1 flexCol',tagClass:'storyTag',listClass:'story list full',tag:'Story:',data:front.vars.fullChapterList,dataprop:'short'},(e)=>{void 0===front.vars.loadChapterSelector1||void 0===front.vars.loadChapterSelector2||(front.vars.loadChapterSelector1.newData(front.vars.fullChapterList[e].chapters),front.vars.loadChapterSelector2.newData(front.vars.fullChapterList[e].chapters),front.vars.loadChapterSelector2.goto(front.vars.fullChapterList[e].chapters.length-1))})),front.vars.loadChapterSelector1===void 0&&(front.vars.loadChapterSelector1=new front.proto.picker({target:document.querySelector('#loadStoryPicker'),frameClass:'chapterpicker1 flexCol',tagClass:'chapterTag',listClass:'chapter list full',tag:'Start:',data:front.vars.fullChapterList[0].chapters,factor:1},(e)=>{if(void 0!==front.vars.loadChapterSelector2){var t=-front.vars.loadChapterSelector2.getPosition();e>=t&&front.vars.loadChapterSelector2.goto(e)}})),front.vars.loadChapterSelector2===void 0&&(front.vars.loadChapterSelector2=new front.proto.picker({target:document.querySelector('#loadStoryPicker'),frameClass:'chapterpicker2 flexCol',tagClass:'chapterTag',listClass:'chapter list full',tag:'End:',data:front.vars.fullChapterList[0].chapters,factor:1},(e)=>{if(void 0!==front.vars.loadChapterSelector1){var t=-front.vars.loadChapterSelector1.getPosition();e<=t&&front.vars.loadChapterSelector1.goto(e)}}),front.vars.loadChapterSelector2.goto(front.vars.fullChapterList[0].chapters.length-1),e.className=e.className.replace(' inactive',''),e.addEventListener('click',front.handler.menu.loadChapters,!1),t.remove())}).catch((e)=>console.log(e))},front.registerServiceWorker=()=>{let e;navigator.onLine&&navigator.serviceWorker.register('service-worker.js').then(()=>{return navigator.serviceWorker.ready}).then((t)=>{return e=t,t.pushManager.getSubscription()}).then((t)=>{return t?t:e.pushManager.subscribe({userVisibleOnly:!0})}).then((e)=>{return front.serverActions.messagingKey(e,!1)}).catch((e)=>console.warn('registerServiceWorker error',e))},front.init()});